{"ast":null,"code":"import { handleErrors } from '../server';\nimport { randomBytes } from 'crypto';\n\nconst generateToken = () => randomBytes(8).toString('hex');\n\nconst login = (schema, req) => {\n  const {\n    username,\n    password\n  } = JSON.parse(req.requestBody);\n  const user = schema.users.findBy({\n    username\n  });\n\n  if (!user) {\n    return handleErrors(null, 'No user with that username exists');\n  }\n\n  if (password !== user.password) {\n    return handleErrors(null, 'Password is incorrect');\n  }\n\n  const token = generateToken();\n  return {\n    user: user.attrs,\n    token\n  };\n};\n\nconst signup = (schema, req) => {\n  const data = JSON.parse(req.requestBody);\n  const exUser = schema.users.findBy({\n    username: data.username\n  });\n\n  if (exUser) {\n    return handleErrors(null, 'A user with that username already exists.');\n  }\n\n  const user = schema.users.create(data);\n  const token = generateToken();\n  return {\n    user: user.attrs,\n    token\n  };\n};\n\nexport default {\n  login,\n  signup\n};","map":{"version":3,"sources":["/home/muhibullahkamali/GitHub/diaries-app/src/services/mirage/routes/user.ts"],"names":["handleErrors","randomBytes","generateToken","toString","login","schema","req","username","password","JSON","parse","requestBody","user","users","findBy","token","attrs","signup","data","exUser","create"],"mappings":"AACA,SAASA,YAAT,QAA6B,WAA7B;AAEA,SAASC,WAAT,QAA4B,QAA5B;;AAEA,MAAMC,aAAa,GAAG,MAAMD,WAAW,CAAC,CAAD,CAAX,CAAeE,QAAf,CAAwB,KAAxB,CAA5B;;AAOA,MAAMC,KAAK,GAAG,CAACC,MAAD,EAAcC,GAAd,KAAwD;AACpE,QAAM;AAAEC,IAAAA,QAAF;AAAYC,IAAAA;AAAZ,MAAyBC,IAAI,CAACC,KAAL,CAAWJ,GAAG,CAACK,WAAf,CAA/B;AACA,QAAMC,IAAI,GAAGP,MAAM,CAACQ,KAAP,CAAaC,MAAb,CAAoB;AAAEP,IAAAA;AAAF,GAApB,CAAb;;AACA,MAAI,CAACK,IAAL,EAAW;AACT,WAAOZ,YAAY,CAAC,IAAD,EAAO,mCAAP,CAAnB;AACD;;AACD,MAAIQ,QAAQ,KAAKI,IAAI,CAACJ,QAAtB,EAAgC;AAC9B,WAAOR,YAAY,CAAC,IAAD,EAAO,uBAAP,CAAnB;AACD;;AACD,QAAMe,KAAK,GAAGb,aAAa,EAA3B;AACA,SAAO;AACLU,IAAAA,IAAI,EAAEA,IAAI,CAACI,KADN;AAELD,IAAAA;AAFK,GAAP;AAID,CAdD;;AAgBA,MAAME,MAAM,GAAG,CAACZ,MAAD,EAAcC,GAAd,KAAwD;AACrE,QAAMY,IAAI,GAAGT,IAAI,CAACC,KAAL,CAAWJ,GAAG,CAACK,WAAf,CAAb;AACA,QAAMQ,MAAM,GAAGd,MAAM,CAACQ,KAAP,CAAaC,MAAb,CAAoB;AAAEP,IAAAA,QAAQ,EAAEW,IAAI,CAACX;AAAjB,GAApB,CAAf;;AACA,MAAIY,MAAJ,EAAY;AACV,WAAOnB,YAAY,CAAC,IAAD,EAAO,2CAAP,CAAnB;AACD;;AACD,QAAMY,IAAI,GAAGP,MAAM,CAACQ,KAAP,CAAaO,MAAb,CAAoBF,IAApB,CAAb;AACA,QAAMH,KAAK,GAAGb,aAAa,EAA3B;AACA,SAAO;AACLU,IAAAA,IAAI,EAAEA,IAAI,CAACI,KADN;AAELD,IAAAA;AAFK,GAAP;AAID,CAZD;;AAcA,eAAe;AACbX,EAAAA,KADa;AAEba,EAAAA;AAFa,CAAf","sourcesContent":["import { Response, Request } from 'miragejs';\nimport { handleErrors } from '../server';\nimport { User } from '../../../interfaces/user.interface';\nimport { randomBytes } from 'crypto';\n\nconst generateToken = () => randomBytes(8).toString('hex');\n\nexport interface AuthResponse {\n  token: string;\n  user: User;\n}\n\nconst login = (schema: any, req: Request): AuthResponse | Response => {\n  const { username, password } = JSON.parse(req.requestBody);\n  const user = schema.users.findBy({ username });\n  if (!user) {\n    return handleErrors(null, 'No user with that username exists');\n  }\n  if (password !== user.password) {\n    return handleErrors(null, 'Password is incorrect');\n  }\n  const token = generateToken();\n  return {\n    user: user.attrs as User,\n    token,\n  };\n};\n\nconst signup = (schema: any, req: Request): AuthResponse | Response => {\n  const data = JSON.parse(req.requestBody);\n  const exUser = schema.users.findBy({ username: data.username });\n  if (exUser) {\n    return handleErrors(null, 'A user with that username already exists.');\n  }\n  const user = schema.users.create(data);\n  const token = generateToken();\n  return {\n    user: user.attrs as User,\n    token,\n  };\n};\n\nexport default {\n  login,\n  signup,\n};\n"]},"metadata":{},"sourceType":"module"}